# Case 1: Using the Gateway as Middleware for READ and WRITE in EVM-based blockchains

This example demonstrates how to use the Gateway as a middleware layer to perform both READ and WRITE operations on an EVM-based blockchain (specifically, Hardhat). The scenario shows interaction with a simple smart contract through the Gateway's `/oracle/execute` endpoint.

For this, we will use the `OracleTestContract` contract, which is a simple contract that allows us to store and retrieve data. The contract has two functions:

* **`setData(string memory data)`** – Stores data on-chain and associates it with a `bytes32` ID.
* **`getData(bytes32 id)`** – Retrieves data from the contract by its ID.



## Terminal Overview

Before starting, here is a summary of what each terminal will be used for in this case:

- **Terminal 1:** Run the Gateway (Docker Compose)
- **Terminal 2:** Start Hardhat EVM Blockchain (port 8545)
- **Terminal 3:** Deploy the OracleTestContract smart contract
- **Terminal 4:** Run the Oracle interaction script (read/write via Gateway)

This pattern is similar in other Oracle cases:
- **Gateway terminal** (usually Terminal 1): Always run the Gateway via Docker Compose
- **EVM/Hardhat terminal(s)** (usually Terminal 2, sometimes 2 and 3): Start one or more local blockchains
- **Deployment/Script terminal(s)** (Terminals 3+): Deploy contracts and run interaction scripts

Refer to each case's README for the exact mapping and steps.

## Setup Instructions

### 1. Start the Gateway (Docker)

In terminal 1, from this directory:

```bash
docker compose up
```

This will start the Gateway with the corresponding configuration file located in `./config/config-oracle-execute-manual-read-and-write.json`.




### 2. Start the Hardhat EVM Blockchain

In terminal 2, from this directory, run:

```bash
cd ../../../EVM && npx hardhat node --hostname 0.0.0.0 --port 8545
```

> ⚠️ Make sure to use `--hostname 0.0.0.0` so that the Gateway (inside Docker) can access the local Hardhat node.


### 3. Deploy the Smart Contract

In terminal 3, from this directory, run:

```bash
cd ../../../EVM && npx hardhat ignition deploy ./ignition/modules/OracleTestContract.js --network hardhat1
```

> This deploys the `OracleTestContract` to the running Hardhat network (`hardhat1` should be configured in `hardhat.config.js` to point to `http://0.0.0.0:8545`).


### 4. Run the Oracle Interaction Script

In terminal 4, from this directory (`gateway/oracle/case_1`):

```bash
python3 oracle-execute-manual-read-and-write.py
```

> This script sends POST requests to the Gateway to trigger contract `setData` and `getData` functions via `/oracle/execute`.

---

## Result

Check the logs in terminal 4 where you executed the `oracle-execute-manual-read-and-write.py` script. You should see the following:
1. The response from the Gateway confirming the transaction (write) to the EVM-based blockchain.
2. The response from the Gateway confirming the read result from the EVM-based blockchain.

```shell
COMPLETE
```

Also check the logs in terminal 2 where you started the Hardhat node. You should see logs confirming the transaction (write) and the read result, verifying that the Gateway is functioning as a middleware for interacting with EVM-based blockchains.


Finally, you can access the `./satp-hermes-gateway/logs/` directory (relative to this case folder) to see the logs generated by the Gateway. The logs will contain detailed information about the requests and responses, including any errors or warnings that may have occurred during the process.
